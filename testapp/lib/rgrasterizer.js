var RG;(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Camera:()=>y,Color:()=>o,Context:()=>i,MaterialLoader:()=>x,ObjLoader:()=>p,Scene:()=>s,SceneRenderer:()=>n,TriangleObject:()=>d,TriangleRenderer:()=>g,Vec2:()=>a,Vec3:()=>r});class i{constructor(t,e,i,s){this.clientWidth=t,this.clientHeight=e,this.resolution=i,this.drawingContext=s,this.FRAME_BUFFER,this.Z_BUFFER}clear=function(){this.drawingContext.clearRect(0,0,this.clientWidth,this.clientHeight)};getRenderWidth=function(){return Math.floor(this.clientWidth*this.resolution)||0};getRenderHeight=function(){return Math.floor(this.clientHeight*this.resolution)||0};static createFromCanvas2d=function(t,e){let s=new i(t.canvas.clientWidth,t.canvas.clientHeight,e,t);return s.FRAME_BUFFER=new Uint8ClampedArray(s.getRenderWidth()*s.getRenderHeight()*4).fill(0),s.Z_BUFFER=new Array(s.getRenderWidth()*s.getRenderHeight()).fill(0),s};getFrameBuffer=function(t,e){return this.FRAME_BUFFER[4*(e*this.getRenderWidth()+t)]};setFrameBuffer=function(t,e,i){let s=this.getRenderWidth(),n=i.getRgba255();this.FRAME_BUFFER[4*(e*s+t)]=n.r,this.FRAME_BUFFER[4*(e*s+t)+1]=n.g,this.FRAME_BUFFER[4*(e*s+t)+2]=n.b,this.FRAME_BUFFER[4*(e*s+t)+3]=n.a};getZBuffer=function(t,e){return this.Z_BUFFER[e*this.getRenderWidth()+t]};setZBuffer=function(t,e,i){this.Z_BUFFER[e*this.getRenderWidth()+t]=i};drawFrameBufferAndClear=function(){let t=new ImageData(this.FRAME_BUFFER,this.getRenderWidth());this.drawingContext.imageSmoothingEnabled=!1,(async()=>{let e=await createImageBitmap(t);this.drawingContext.drawImage(e,0,0,this.getRenderWidth(),this.getRenderHeight(),0,0,this.clientWidth,this.clientHeight)})(),this.FRAME_BUFFER.fill(255),this.Z_BUFFER.fill(0)}}class s{constructor(){this.objects=[],this.materials=[]}useMTLs=function(t){this.materials.push(...t)};add=function(t){Array.isArray(t)?this.objects.push(...t):this.objects.push(t)};render=function(t,e){this.objects.forEach((i=>{i.render(e,t,this.materials)})),t.drawFrameBufferAndClear()}}class n{constructor(t,e){this.rgContext=t,this.rgCamera=e}drawFrame=function(t){t.render(this.rgContext,this.rgCamera)}}class r{constructor(t,e,i){this.x=t,this.y=e,this.z=i}static dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z};static cross=function(t,e){return new r(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)};minus=function(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)};plus=function(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)};multiplyScalar=function(t){return new r(this.x*t,this.y*t,this.z*t)};distanceTo=function(t){return Math.abs(Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)+(t.z-this.z)*(t.z-this.z)))};magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};normalized=function(){return new r(this.x/this.magnitude(),this.y/this.magnitude(),this.z/this.magnitude())}}class h{constructor(t,e,i,s){this.w=t,this.i=e,this.j=i,this.k=s,this.normalize()}static fromAngleAxis=function(t,e){return e=e.normalized(),new h(Math.cos(t/2),Math.sin(t/2)*e.x,Math.sin(t/2)*e.y,Math.sin(t/2)*e.z)};static getMultiplication=function(t,e){return new h(t.w*e.w-t.i*e.i-t.j*e.j-t.k*e.k,t.w*e.i+t.i*e.w-t.j*e.k+t.k*e.j,t.w*e.j+t.i*e.k+t.j*e.w-t.k*e.i,t.w*e.k-t.i*e.j+t.j*e.i+t.k*e.w)};inverse=function(){return new h(this.w,-this.i,-this.j,-this.k)};magnitude=function(){return Math.sqrt(this.w*this.w+this.i*this.i+this.j*this.j+this.k*this.k)};normalize=function(){let t=this.magnitude();this.w/=t,this.i/=t,this.j/=t,this.k/=t};rotate3dPoint=function(t){let e=new h(0,t.x,t.y,t.z),i=h.getMultiplication(this.inverse(),e),s=h.getMultiplication(i,this);return new r(s.i,s.j,s.k)}}class o{constructor(t,e,i,s){this.r=Math.max(0,Math.min(1,t)),this.g=Math.max(0,Math.min(1,e)),this.b=Math.max(0,Math.min(1,i)),this.a=Math.max(0,Math.min(1,s))}getRgba255=function(){return{r:255*this.r,g:255*this.g,b:255*this.b,a:255*this.a}};static multiply=function(t,e){return new o(t.r*e.r,t.g*e.g,t.b*e.b,t.a*e.a)}}class a{constructor(t,e){this.x=t,this.y=e}static dot=function(t,e){return t.x*e.x+t.y*e.y};static cross=function(t,e){return t.x*e.y-t.y*e.x};minus=function(t){return new a(this.x-t.x,this.y-t.y)};plus=function(t){return new a(this.x-t.x,this.y-t.y)};multiplyScalar=function(t){return new a(this.x*t,this.y*t)}}class l{constructor(t,e){this.point=t,this.normal=e}static fromPoints(t){let e=t[0].minus(t[1]),i=t[0].minus(t[2]),s=r.cross(i,e).normalized();return new l(t[0],s)}}function c(t,e,i){let s=new a(e.x-t.x,e.y-t.y),n=new a(i.x-t.x,i.y-t.y);return Math.sign(a.cross(s,n))}class u{constructor(t,e){3!=t.length&&console.error("RGScreenTriangle must contain exactly 3 verticies"),this.verts=t,this.textureCoords=e}area=function(){let t=this.getVerts();return Math.abs((t[0].x*(t[1].y-t[2].y)+t[1].x*(t[2].y-t[0].y)+t[2].x*(t[0].y-t[1].y))/2)};get2dBoundingBox=function(){return{lower:{x:Math.floor(Math.min(this.verts[0].x,this.verts[1].x,this.verts[2].x)),y:Math.floor(Math.min(this.verts[0].y,this.verts[1].y,this.verts[2].y))},upper:{x:Math.ceil(Math.max(this.verts[0].x,this.verts[1].x,this.verts[2].x)),y:Math.ceil(Math.max(this.verts[0].y,this.verts[1].y,this.verts[2].y))},clip:function(t,e,i,s){this.lower.x=Math.max(t,this.lower.x),this.lower.y=Math.max(e,this.lower.y),this.upper.x=Math.min(i,this.upper.x),this.upper.y=Math.min(s,this.upper.y)},width:function(){return this.upper.x-this.lower.x},height:function(){return this.upper.y-this.lower.y}}};getVerts=function(){return this.verts};contains=function(t){let e=0;return e+=c(this.verts[0],this.verts[1],t),e+=c(this.verts[1],this.verts[2],t),e+=c(this.verts[2],this.verts[0],t),3==Math.abs(e)};getBarycentric=function(t){let e=new u([t,this.verts[0],this.verts[1]]).area()/this.area(),i=new u([t,this.verts[1],this.verts[2]]).area()/this.area(),s=new u([t,this.verts[0],this.verts[2]]).area()/this.area();return new r(i,s,e)};getUV(t){return new a(t.x*this.textureCoords[0].x+t.y*this.textureCoords[1].x+t.z*this.textureCoords[2].x,t.x*this.textureCoords[0].y+t.y*this.textureCoords[1].y+t.z*this.textureCoords[2].y)}}class g{static render=function(t,e,i,s){let n=[],r=[];t.getVerts().forEach(((s,h)=>{let o=function(t,e){let i=t.minus(e.getPos()),s=e.rot.inverse().rotate3dPoint(i),n=e.getSettings().focalLength;return new a(s.x*n/s.z,s.y*n/s.z)}(s,e),l=(u=e,g=i,new a(((c=o).x+1)/u.getSettings().viewportWidth*g.getRenderWidth(),(-1*c.y+1)/u.getSettings().viewportHeight*g.getRenderHeight()));var c,u,g;n.push(l),r.push(t.textureCoords[h])}));let h=new u(n,r),o=h.get2dBoundingBox();o.clip(0,0,i.getRenderWidth(),i.getRenderHeight());for(let n=o.lower.y;n<o.upper.y;n++)for(let r=o.lower.x;r<o.upper.x;r++)if(h.contains(new a(r,n))){let o=h.getBarycentric(new a(r,n)),l=t.worldFromBarycentric(o);if(1/e.pos.distanceTo(l)>i.getZBuffer(r,n))if(i.setZBuffer(r,n,1/e.pos.distanceTo(l)),s){let t=h.getUV(o);i.setFrameBuffer(r,n,s.getColorUV(t.x,t.y))}else i.setFrameBuffer(r,n,t.color)}}}class d{constructor(t){3!=t.length&&console.error("RGTriangleObject must contain exactly 3 verticies"),this.verts=t,this.pos=new r(0,0,0),this.scale=1,this.color=new o(Math.random(),Math.random(),Math.random(),1),this.rotation=new h(0,0,0,0),this.rotationCenter=new r(0,0,0),this.textureCoords=[]}rotateAround=function(t,e,i){this.rotation=h.fromAngleAxis(e,i),this.rotationCenter=t};getVerts=function(){let t=[];return this.verts.forEach((e=>{let i=this.rotation.rotate3dPoint(e.minus(this.rotationCenter)).plus(this.rotationCenter).plus(this.pos);i=i.minus(this.pos).multiplyScalar(this.scale).plus(this.pos),t.push(i)})),t};worldFromBarycentric=function(t){let e=this.getVerts();return new r(t.x*e[0].x+t.y*e[1].x+t.z*e[2].x,t.x*e[0].y+t.y*e[1].y+t.z*e[2].y,t.x*e[0].z+t.y*e[1].z+t.z*e[2].z)};clip=function(t){let e=[this];return t.forEach((t=>{let i=[];e.forEach((e=>{let s=e.getVerts(),n=Math.sign(r.dot(s[0].minus(t.point),t.normal));n==Math.sign(r.dot(s[1].minus(t.point),t.normal))==Math.sign(r.dot(s[2].minus(t.point),t.normal))&&n>0&&i.push(e)})),e=i})),e};render=function(t,e,i){let s=t.getClippingPlanes();this.clip([s.near,s.left,s.right,s.top,s.bottom]).forEach((n=>{r.dot(s.near.normal,l.fromPoints(n.getVerts()).normal)>=0&&g.render(n,t,e,i)}))}}class f{constructor(t,e,i,s,n){this.name=t,this.verts=e,this.faces=i,this.matName=n,this.textureCoords=s,this.tris=[],this.pos=new r(0,0,0),this.scale=1,this.rotation=new h.fromAngleAxis(0,new r(1,0,0)),this.rotationCenter=new r(0,0,0)}rotateAround=function(t,e,i){this.rotation=h.fromAngleAxis(e,i),this.rotationCenter=t};setPos=function(t){this.pos=t};scaleTo=function(t){this.scale=t};static getVerts=function(t){let e=[];return t.forEach((t=>{let i=t.split(/\s+/g).filter((t=>String(t).trim()));"v"==i[0]&&e.push(new r(i[1],i[2],i[3]))})),e};static getFaces=function(t){let e=[];return t.forEach((t=>{let i=t.split(/\s+/g).filter((t=>String(t).trim()));if("f"==i[0]){let t=[];for(let e=1;e<i.length;e++)t.push({vertex:i[e].split("/")[0],texture:i[e].split("/")[1]});e.push(t)}})),e};static getTextureCoords=function(t){let e=[];return t.forEach((t=>{let i=t.split(/\s+/g).filter((t=>String(t).trim()));"vt"==i[0]&&e.push(new a(i[1],i[2],i[3]))})),e};triangulate=()=>{if(0!=this.tris.length)return this.tris;for(let t=0;t<this.faces.length;t++){let e=new o(Math.random(),Math.random(),Math.random(),1),i=new d([this.verts[this.faces[t][0].vertex-1],this.verts[this.faces[t][1].vertex-1],this.verts[this.faces[t][2].vertex-1]]);i.textureCoords=[this.textureCoords[this.faces[t][0].texture-1],this.textureCoords[this.faces[t][1].texture-1],this.textureCoords[this.faces[t][2].texture-1]],i.color=e,this.tris.push(i)}return this.tris};render=function(t,e,i){this.triangulate().forEach((s=>{let n;s.rotation=this.rotation,s.rotationCenter=this.rotationCenter,s.pos=this.pos,s.scale=this.scale,i.forEach((t=>{t.name==this.matName&&(n=t)})),s.render(t,e,n)}))}}class p{constructor(t,e=()=>{}){this.filename=t,this.onload=e,this.readLine=0,this.lines=[],(async()=>{await fetch(this.filename).then((t=>t.text())).then((t=>{this.lines=t.split(/\r?\n/),this.loadInvObjects(),this.onload()}))})(),this.individualObjects=[],this.tris=[],this.pos=new r(0,0,0),this.scale=1,this.rotation=new h.fromAngleAxis(0,new r(1,0,0)),this.rotationCenter=new r(0,0,0)}getObjects=function(){return this.individualObjects};loadInvObjects=function(){let t=[];this.lines.forEach(((e,i)=>{"o"==e.split(" ")[0]&&t.push(i)})),0!=t.length?t.forEach(((e,i)=>{t[i+1]?this.individualObjects.push(p.generateRGObjectFromLines(this.lines.slice(e,t[i+1]))):this.individualObjects.push(p.generateRGObjectFromLines(this.lines.slice(e)))})):this.individualObjects.push(p.generateRGObjectFromLines(this.lines))};static generateRGObjectFromLines=function(t){let e="",i="",s=f.getVerts(t),n=f.getFaces(t),r=f.getTextureCoords(t);return t.forEach(((t,s)=>{let n=t.split(" ");"o"==n[0]&&(e=n[1]),"usemtl"==n[0]&&(i=n[1])})),new f(e,s,n,r,i)}}class m{constructor(t="",e={}){this.name=t,this.texLoaded=0,this.texToLoad=0,this.Ka=e.Ka||new o,this.Kd=e.Kd||new o,this.Ks=e.Ks||new o,this.map_Ka=e.map_Ka,this.map_Kd=e.map_Kd,this.map_Ks=e.map_Ks,this.Ns=e.Ns,this.d=e.d,this.illum=e.illum}checkLoaded=t=>{this.texLoaded==this.texToLoad&&t()};getColorUV=function(t,e){return this.map_Kd?this.map_Kd.getColorFromUV(t,e):this.Kd}}class w{constructor(t,e,i){this.imageData=t,this.width=e,this.height=i}static fromURL=async function(t){return new Promise(((e,i)=>{let s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{let t=document.createElement("canvas");t.width=s.width,t.height=s.height;let i=t.getContext("2d");i.drawImage(s,0,0),e(new w(i.getImageData(0,0,s.width,s.height),s.width,s.height))},s.onerror=t=>{i(t)},s.src=t}))};getColorFromPixel=function(t,e){return new o(this.imageData.data[4*(e*this.width+t)]/255,this.imageData.data[4*(e*this.width+t)+1]/255,this.imageData.data[4*(e*this.width+t)+2]/255,this.imageData.data[4*(e*this.width+t)+3]/255)};getColorFromUV=function(t,e){let i=Math.floor(t%1*this.width),s=Math.floor(e%1*this.height);return this.getColorFromPixel(i,s)}}class x{constructor(t,e,i=()=>{}){this.filename=t,this.fileSearchDirectory=e,this.onload=i,this.readLine=0,this.lines=[],this.matLoaded=0,this.materials=[],(async()=>{await fetch(this.filename).then((t=>t.text())).then((t=>{this.lines=t.split(/\r?\n/),this.splitLines()}))})()}getMaterials=function(){return this.materials};splitLines=function(){let t=[];this.lines.forEach(((e,i)=>{"newmtl"==e.split(" ")[0]&&t.push(i)})),0!=t.length?t.forEach(((e,i)=>{t[i+1]?this.materials.push(this.generateMatFromLines(this.lines.slice(e,t[i+1]))):this.materials.push(this.generateMatFromLines(this.lines.slice(e)))})):this.materials.push(this.generateMatFromLines(this.lines))};generateMatFromLines=function(t){let e=new m;return t.forEach((t=>{let i=t.split(/\s+/g).filter((t=>String(t).trim()));switch(i[0]){case"newmtl":e.name=i[1];break;case"Ka":case"Kd":case"Ks":e[i[0]]=new o(i[1],i[2],i[3]);break;case"map_Ka":case"map_Kd":case"map_Ks":e.texToLoad++,w.fromURL(this.fileSearchDirectory+i[1]).then((t=>{e[i[0]]=t,e.texLoaded++,e.checkLoaded((()=>{this.matLoaded++,this.matLoaded==this.materials.length&&this.onload()}))}));break;case"Ns":case"d":case"illum":e[i[0]]=i[1]}})),e}}class y{constructor(t,e=null){this.pos=t,this.rot=h.fromAngleAxis(0,new r(0,0,1)),this.rotCenter=this.pos,this.settings={focalLength:1,viewportWidth:2,viewportHeight:2}}getPos=function(){return this.pos};rotateAroundSelf=function(t,e){this.rot=h.getMultiplication(this.rot,new h.fromAngleAxis(t,e)),this.rotCenter=this.pos};moveRelative=function(t){this.pos=this.pos.plus(this.rot.rotate3dPoint(t))};getClippingPlanes(){return{near:l.fromPoints([this.pos.plus(this.rot.rotate3dPoint(new r(-this.settings.viewportWidth/2,this.settings.viewportHeight/2,this.settings.focalLength))),this.pos.plus(this.rot.rotate3dPoint(new r(this.settings.viewportWidth/2,this.settings.viewportHeight/2,this.settings.focalLength))),this.pos.plus(this.rot.rotate3dPoint(new r(this.settings.viewportWidth/2,-this.settings.viewportHeight/2,this.settings.focalLength)))]),left:l.fromPoints([this.pos,this.pos.plus(this.rot.rotate3dPoint(new r(-this.settings.viewportWidth/2,-this.settings.viewportHeight/2,this.settings.focalLength))),this.pos.plus(this.rot.rotate3dPoint(new r(-this.settings.viewportWidth/2,this.settings.viewportHeight/2,this.settings.focalLength)))]),right:l.fromPoints([this.pos,this.pos.plus(this.rot.rotate3dPoint(new r(this.settings.viewportWidth/2,this.settings.viewportHeight/2,this.settings.focalLength))),this.pos.plus(this.rot.rotate3dPoint(new r(this.settings.viewportWidth/2,-this.settings.viewportHeight/2,this.settings.focalLength)))]),top:l.fromPoints([this.pos,this.pos.plus(this.rot.rotate3dPoint(new r(-this.settings.viewportWidth/2,this.settings.viewportHeight/2,this.settings.focalLength))),this.pos.plus(this.rot.rotate3dPoint(new r(this.settings.viewportWidth/2,this.settings.viewportHeight/2,this.settings.focalLength)))]),bottom:l.fromPoints([this.pos,this.pos.plus(this.rot.rotate3dPoint(new r(this.settings.viewportWidth/2,-this.settings.viewportHeight/2,this.settings.focalLength))),this.pos.plus(this.rot.rotate3dPoint(new r(-this.settings.viewportWidth/2,-this.settings.viewportHeight/2,this.settings.focalLength)))])}}getSettings=function(){return this.settings}}RG=e})();